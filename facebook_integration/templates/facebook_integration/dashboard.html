{% extends 'facebook_integration/base.html' %}

{% block title %}Dashboard - Facebook Automation{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block extra_css %}
<style>
.metric-card {
  transition: transform 0.2s;
}
.metric-card:hover {
  transform: translateY(-5px);
}
.chart-container {
  position: relative;
  height: 300px;
}
</style>
{% endblock %}

{% block content %}
<!-- Stats Cards Row 1 - Métricas Principais -->
<div class="row mb-4">
  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card metric-card text-white bg-primary">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="h5 mb-0">{{ total_pages }}</div>
            <div class="small">Páginas Ativas</div>
          </div>
          <div class="h1"><i class="fas fa-facebook"></i></div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card metric-card text-white bg-success">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="h5 mb-0">{{ total_followers|default:0 }}</div>
            <div class="small">Total Seguidores</div>
          </div>
          <div class="h1"><i class="fas fa-users"></i></div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card metric-card text-white bg-info">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="h5 mb-0">{{ total_likes|default:0 }}</div>
            <div class="small">Total Curtidas</div>
          </div>
          <div class="h1"><i class="fas fa-thumbs-up"></i></div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card metric-card text-white bg-warning">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="h5 mb-0">{{ avg_engagement|default:0 }}%</div>
            <div class="small">Engajamento Médio</div>
          </div>
          <div class="h1"><i class="fas fa-chart-line"></i></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Stats Cards Row 2 - Engagement -->
<div class="row mb-4">
  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card metric-card border-left-primary">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <div class="text-muted small">Média de Curtidas</div>
            <div class="h4">{{ avg_likes|default:0 }}</div>
          </div>
          <div class="text-primary"><i class="fas fa-heart fa-2x"></i></div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card metric-card border-left-success">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <div class="text-muted small">Média de Comentários</div>
            <div class="h4">{{ avg_comments|default:0 }}</div>
          </div>
          <div class="text-success"><i class="fas fa-comment fa-2x"></i></div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card metric-card border-left-warning">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <div class="text-muted small">Posts Pendentes</div>
            <div class="h4">{{ pending_posts }}</div>
          </div>
          <div class="text-warning"><i class="fas fa-clock fa-2x"></i></div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card metric-card border-left-info">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <div class="text-muted small">Publicados Hoje</div>
            <div class="h4">{{ published_today }}</div>
          </div>
          <div class="text-info"><i class="fas fa-check-circle fa-2x"></i></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Páginas com Métricas -->
{% if active_pages %}
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Páginas - Visão Geral</h5>
      </div>
      <div class="card-body">
        <div class="row">
          {% for page in active_pages %}
          <div class="col-lg-4 col-md-6 mb-3">
            <div class="card border-left-primary h-100">
              <div class="card-body">
                <h6 class="card-title">{{ page.name }}</h6>
                <div class="mb-2">
                  <i class="fas fa-users text-primary"></i>
                  <strong>{{ page.followers_count|default:0 }}</strong> seguidores
                </div>
                <a href="{% url 'facebook_integration:page_detail' page.pk %}" class="btn btn-sm btn-outline-primary">
                  Ver Detalhes <i class="fas fa-arrow-right"></i>
                </a>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}

<!-- Quick Actions -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Ações Rápidas</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6 col-lg-3 mb-3">
            <a href="{% url 'facebook_integration:page_manager' %}" class="btn btn-primary w-100">
              <i class="fas fa-facebook me-2"></i>Gerenciar Páginas
            </a>
          </div>
          <div class="col-md-6 col-lg-3 mb-3">
            <a href="{% url 'facebook_integration:groups_manager' %}" class="btn btn-secondary w-100">
              <i class="bi bi-people-fill me-2"></i>Grupos
            </a>
          </div>
          <div class="col-md-6 col-lg-3 mb-3">
            <a href="{% url 'facebook_integration:create_template' %}" class="btn btn-success w-100">
              <i class="fas fa-plus-circle me-2"></i>Novo Template
            </a>
          </div>
          <div class="col-md-6 col-lg-3 mb-3">
            <a href="{% url 'facebook_integration:create_scheduled_post' %}" class="btn btn-warning w-100">
              <i class="fas fa-calendar-plus me-2"></i>Agendar Post
            </a>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 col-lg-3 mb-3">
            <a href="{% url 'facebook_integration:posts' %}" class="btn btn-info w-100">
              <i class="fas fa-list me-2"></i>Ver Posts
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Recent Posts -->
<div class="row">
  <div class="col-lg-6 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Posts Recentes</h5>
      </div>
      <div class="card-body">
        {% if recent_posts %}
        <div class="list-group list-group-flush">
          {% for post in recent_posts %}
          <div class="list-group-item">
            <div class="d-flex justify-content-between align-items-center">
              <div class="flex-grow-1">
                <h6 class="mb-1">{{ post.facebook_page.name }}</h6>
                <p class="mb-1 text-muted small">{{ post.content|truncatewords:15 }}</p>
                <small class="text-muted">
                  <i class="fas fa-calendar"></i> {{ post.published_at|date:"d/m/Y H:i" }}
                </small>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <p class="text-muted text-center">Nenhum post recente</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-lg-6 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Próximos Agendamentos</h5>
      </div>
      <div class="card-body">
        {% if upcoming_posts %}
        <div class="list-group list-group-flush">
          {% for post in upcoming_posts %}
          <div class="list-group-item">
            <div class="d-flex justify-content-between align-items-center">
              <div class="flex-grow-1">
                <h6 class="mb-1">{{ post.facebook_page.name }}</h6>
                <p class="mb-1 text-muted small">{{ post.template.name }}</p>
                <small class="text-warning">
                  <i class="fas fa-clock"></i> {{ post.scheduled_time|date:"d/m/Y H:i" }}
                </small>
              </div>
              <span class="badge bg-{{ post.status|default:'secondary' }}">
                {{ post.get_status_display }}
              </span>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <p class="text-muted text-center">Nenhum post agendado</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
{% endblock %}
