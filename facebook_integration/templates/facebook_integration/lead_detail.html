{% extends "facebook_integration/base.html" %}
{% load static %}

{% block title %}Lead - {{ lead.get_contact_name }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-2">üìß Detalhes do Lead</h1>
                    <p class="text-muted">{{ lead.get_contact_name }}</p>
                </div>
                <a href="{% url 'facebook_integration:leads_list' %}" class="btn btn-secondary">
                    ‚Üê Voltar para Lista
                </a>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Informa√ß√µes do Contato -->
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üë§ Informa√ß√µes de Contato</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Nome:</strong>
                            <p>{{ lead.get_contact_name }}</p>
                        </div>
                        <div class="col-md-6">
                            <strong>Email:</strong>
                            <p><a href="mailto:{{ lead.get_contact_email }}">{{ lead.get_contact_email }}</a></p>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Telefone:</strong>
                            <p>{{ lead.get_contact_phone }}</p>
                        </div>
                        <div class="col-md-6">
                            <strong>Data de Cria√ß√£o:</strong>
                            <p>{{ lead.created_time|date:"d/m/Y H:i" }}</p>
                        </div>
                    </div>

                    <!-- Campos Personalizados -->
                    {% if lead.contact_fields %}
                    <hr>
                    <h6 class="mb-3">Campos Adicionais:</h6>
                    <div class="row">
                        {% for field_name, field_value in lead.contact_fields.items %}
                        <div class="col-md-6 mb-2">
                            <strong>{{ field_name|title }}:</strong>
                            <p>{{ field_value }}</p>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Observa√ß√µes -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">üìù Observa√ß√µes</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        <div class="mb-3">
                            <textarea name="notes" class="form-control" rows="5" placeholder="Adicione observa√ß√µes sobre este lead...">{{ lead.notes }}</textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar Observa√ß√µes</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-md-4">
            <!-- Status -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üìä Status do Lead</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label class="form-label">Status Atual:</label>
                            <select name="status" class="form-select">
                                {% for value, label in status_choices %}
                                <option value="{{ value }}" {% if lead.status == value %}selected{% endif %}>
                                    {{ label }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Atualizar Status</button>
                    </form>

                    <div class="mt-3">
                        <small class="text-muted">
                            √öltima atualiza√ß√£o: {{ lead.updated_at|date:"d/m/Y H:i" }}
                        </small>
                    </div>
                </div>
            </div>

            <!-- Origem -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üéØ Origem</h5>
                </div>
                <div class="card-body">
                    <p><strong>P√°gina:</strong><br>
                    <a href="{% url 'facebook_integration:page_detail' lead.page.id %}">{{ lead.page.name }}</a></p>

                    <p><strong>Formul√°rio:</strong><br>{{ lead.form_name }}</p>

                    <p><strong>Tipo:</strong><br>
                    {% if lead.is_organic %}
                        <span class="badge bg-success">Lead Org√¢nico</span>
                    {% else %}
                        <span class="badge bg-primary">Lead Pago</span>
                    {% endif %}
                    </p>

                    {% if not lead.is_organic %}
                    <hr>
                    <p><strong>Campanha:</strong><br>
                    <small>{{ lead.campaign_name|default:"N/A" }}</small></p>

                    <p><strong>An√∫ncio:</strong><br>
                    <small>{{ lead.ad_name|default:"N/A" }}</small></p>

                    {% if lead.campaign_id %}
                    <p><strong>IDs:</strong></p>
                    <ul class="list-unstyled small">
                        <li>Campanha: <code>{{ lead.campaign_id }}</code></li>
                        {% if lead.ad_id %}
                        <li>An√∫ncio: <code>{{ lead.ad_id }}</code></li>
                        {% endif %}
                    </ul>
                    {% endif %}
                    {% endif %}
                </div>
            </div>

            <!-- Metadados -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">‚ÑπÔ∏è Metadados</h5>
                </div>
                <div class="card-body">
                    <p><strong>Lead ID:</strong><br>
                    <code>{{ lead.lead_id }}</code></p>

                    <p><strong>Form ID:</strong><br>
                    <code>{{ lead.form_id }}</code></p>

                    <p><strong>Coletado em:</strong><br>
                    {{ lead.collected_at|date:"d/m/Y H:i" }}</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
